<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File upload</title>
    <style>
      .uploaded-image {
        display: block;
        width: 300px;
      }
    </style>
  </head>
  <body>
    <input class="input-file" type="file" accept="image/*" />
    <button class="upload">upload</button>
    <img class="uploaded-image" />

    <script>
      const $uploadedImage = document.querySelector('.uploaded-image');
      const $inputFile = document.querySelector('.input-file');
      const $upload = document.querySelector('.upload');

      $upload.onclick = async e => {
        // 업로드된 파일
        const uploadedFile = $inputFile.files[0];

        const formData = new FormData();
        formData.append('img', uploadedFile);

        // 폼데이터를 서버로 전송한다.
        const res = await fetch('/upload', {
          method: 'POST',
          // headers: { 'Content-Type': 'multipart/form-data' },
          // body: JSON.stringify(formData)
          body: formData
        });
        const { success, file } = await res.json();

        if (success) {
          console.log('UPLOAD SUCCESS!', file);
          $uploadedImage.src = `/img/${file.originalname}`;
        }
      };
    </script>
  </body>
</html>
